#include <DHT.h>

#define DHTPIN D4
#define DHTTYPE DHT11
DHT dht(DHTPIN, DHTTYPE);

#define SOIL_SENSOR A0
#define RELAY_PIN D6

void setup() {
  Serial.begin(9600);
  dht.begin();

  pinMode(RELAY_PIN, OUTPUT);
  digitalWrite(RELAY_PIN, HIGH);  // Pump OFF

  Serial.println("Smart Farming System Started...");
}

void loop() {
  // Soil moisture reading (0–1023)
  int soilValue = analogRead(SOIL_SENSOR);
  int soilPercent = map(soilValue, 1023, 0, 0, 100);  // Convert to percentage

  // Temperature/Humidity
  float temperature = dht.readTemperature();
  float humidity = dht.readHumidity();

  // Display values
  Serial.print("Soil Moisture: "); Serial.print(soilPercent); Serial.println("%");
  Serial.print("Temperature: "); Serial.print(temperature); Serial.println("°C");
  Serial.print("Humidity: "); Serial.print(humidity); Serial.println("%");
  Serial.println("--------------------------");

  // Automatic irrigation control
  if (soilPercent < 40) {          // If soil is dry
    digitalWrite(RELAY_PIN, LOW);  // Pump ON
    Serial.println("Pump ON - Soil is dry");
  } else {
    digitalWrite(RELAY_PIN, HIGH); // Pump OFF
    Serial.println("Pump OFF - Soil OK");
  }

  delay(2000);
}